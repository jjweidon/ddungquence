---
description: USE WHEN planning implementation steps in Cursor (vibe coding). Follow small-slice workflow and project-specific prompts.
globs:
alwaysApply: false
---
# Cursor 바이브코딩 워크플로

## 작업 원칙
- **작게 생성 → 즉시 실행/테스트 → 다음 단계**
- 한 번에 큰 덩어리로 만들지 말고, “동작하는 최소 조각”부터 쌓는다.
- 생성 코드가 문서(요구사항/스키마/규칙)와 일치하는지 즉시 리뷰한다.

## 권장 작업 순서(프롬프트 시나리오)
### P0 부트스트랩
- Next.js(App Router)+TS+Tailwind 구성
- Firebase client 초기화(`src/lib/firebase/client.ts`)
- Google 로그인(`src/features/auth/ensureAuth.ts`)
- 라우팅: `/`, `/lobby/[code]`, `/game/[roomId]`

### P1 로비(E2E)
- `createRoom(nickname)`:
  - `rooms/{roomId}` + `roomCodes/{code}`
- `joinRoomByCode(code, nickname)`:
  - roomCodes 조회 → players/{uid} create
- 로비 화면에서 players 리스트 실시간 구독 + Ready/팀 선택(본인 문서 update)
- host만 게임 시작 버튼 노출

### P2 도메인(룰 엔진)
- `src/domain`에 pure function으로 작성 + Vitest 단위 테스트
  - 덱 생성/셔플(104장)
  - 잭 규칙(2-eye/1-eye)
  - 데드 카드 판정(변형: 교체 없음)
  - 시퀀스 탐지(중복 1칸 허용, 코너 점유)

### P3 게임 시작(딜링)
- host만:
  - privateDealer/deck 저장
  - privateHands/{uid} 초기 손패 분배
  - rooms/{roomId} status=playing + game 초기화

### P4 턴 액션(트랜잭션)
- `submitTurnAction(roomId, action)`:
  - expectedVersion 검증 + public 업데이트를 transaction으로 수행
  - normal / 2-eye / 1-eye 지원
- 주의: 변형 규칙 고정 → **데드 카드 교체/버리기 액션은 지원하지 않는다.**
- UI: 가능한 칸/제거 가능 칩 하이라이트 + txPending 잠금 UX

### P5 폴리싱/배포
- offline 감지 시 턴 액션 disable
- Vercel 배포 체크리스트 반영
