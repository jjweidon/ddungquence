---
description: USE WHEN writing tests or changing domain logic / Firestore repositories. Follow project test strategy (Vitest + emulator).
globs: **/*.test.ts,**/*.test.tsx,**/*.spec.ts,**/*.spec.tsx,vitest.config.ts,vitest.config.js
alwaysApply: false
---
# 테스트 전략

## 목표
- 도메인(룰)은 단위 테스트로 확실히 잠근다(P0)
- Firestore 동기화는 에뮬레이터 기반 통합 테스트로 최소 보장(P1)
- MVP는 핵심 플로우 1~2개만 e2e로 커버

## 레이어별
### 도메인 단위 테스트(P0, Vitest 권장)
대상:
- 덱 생성/셔플(104장, 중복/누락 없음)
- 잭 규칙(2-eye 배치, 1-eye 제거 제한)
- 데드 카드 판정(변형: 교체 없음, 손에 유지/사용 불가)
- 시퀀스 판정(가로/세로/대각)
  - 변형: 코너도 점유 저장(와일드/공유 아님)
  - 2시퀀스 모드: 중복 1칸 허용

### 리포지토리 통합 테스트(P1, Emulator)
대상:
- room 생성/참가/ready
- 게임 시작 딜링(host only)
- 턴 액션 트랜잭션 충돌(expectedVersion mismatch)

### e2e(P1, 최소)
- “방 생성 → 참가 → Ready → 시작 → 1~2턴 진행” 정도만 최소 커버

## 원칙
- 도메인 함수는 pure function 기반(테스트 용이)
- 버그 재현 케이스는 테스트로 고정하고 회귀 방지
