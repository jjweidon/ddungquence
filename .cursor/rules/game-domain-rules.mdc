---
description: USE WHEN implementing game domain logic: deck, jacks, dead card, corner rules, sequence detection, win conditions.
globs: src/domain/**/*.ts,src/domain/**/*.tsx
alwaysApply: false
---
# 게임 룰/도메인 로직 (구현 기준)

## 턴 진행(핵심)
1) 손에서 카드 1장 선택 → discard(공개)
2) 규칙에 따라 칩 배치/제거
3) 턴 종료 시 **자동 드로우 1장**(실수 케이스 제거)

## 잭 규칙
- 보드에는 잭이 없다(행동 카드).
- Two-eyed Jack(2-eye): **j_2** (카드 ID `*_j_2`) → 어떤 빈 칸에 칩 배치
  - **변형 규칙**: 2-eye로 배치된 칸은 **바로 다음 플레이어만** 1-eye로 제거 불가(그 다음 순서부터 가능)
- One-eyed Jack(1-eye): **j_1** (카드 ID `*_j_1`) → 칩 1개 제거(상대·자기 팀 모두 가능)
  - 완성된 시퀀스에 포함된 칩은 제거 불가(MVP)
  - **변형 규칙**: 1-eye로 제거된 칸은 **바로 다음 플레이어만** 2-eye로 배치 불가(그 다음 순서부터 가능)

## 데드 카드(변형 규칙 고정)
- 보드 상 두 칸이 모두 점유되어 더 이상 둘 곳이 없으면 데드 카드
- 데드 카드는 **교체/버리기 없음**. 손에 남기고 “사용 불가”로만 처리한다.

## 코너 규칙(변형 규칙 고정)
- 코너 cellId: 0, 9, 90, 99
- 코너는 와일드가 아니다.
  - 코너 카드로 칩을 놓는다.
  - 코너 칸은 팀 전용(공유 불가)

## 시퀀스/승리 조건
- 시퀀스: 같은 팀 칩 5개 직선 연속(가로/세로/대각)
- 2팀 모드(MVP): 2시퀀스 먼저 만들면 승리
- 중복 규칙 고정: 두 번째 시퀀스는 첫 시퀀스와 **1칸만** 겹칠 수 있다.

## 6목(6개 이상 연속) 정책(고정)
- 동일 방향으로 **6개 이상 연속**이면 그 안의 어떤 5칸 윈도우도 **시퀀스로 인정하지 않는다.**
- 이미 완성된 시퀀스에 1칸 추가로 6개가 되는 경우도 동일: 기존 시퀀스와 겹침 규칙(2칸 이상 겹치면 거부)에 의해 자연스럽게 처리된다.
- **해소 방법**: one-eyed Jack으로 양쪽 끝 칩 중 하나를 제거해 5개만 남기면 비로소 시퀀스로 인정한다.
- **구현 위치**: `src/domain/rules/sequenceDetect.ts` — `findAllCandidates`에서 5칸 후보의 시작 직전 / 끝 직후 칸에 동일 팀 칩이 있으면 해당 후보를 제외한다.

## 덱
- 2덱(104장), 잭 8장
- 변형 규칙: 덱 소진까지 승부가 안 나면 **무승부**, 리셔플 없음

## 구현 원칙
- `src/domain/**`는 UI/Firebase에 의존하지 않는 **pure function**으로 작성한다.
- 도메인 로직은 Vitest 단위 테스트로 잠근다(최소 10케이스 이상 권장).
