# 10. 로드맵(진행도 점검표)

> 목표: Cursor로 구현을 쪼개기 쉬운 “작업 단위”로 분해하고, 각 단계의 DoD를 명확히 한다.

---

## M0. 프로젝트 부트스트랩
- [x] Next.js(App Router) + TS + Tailwind 초기화
- [x] ESLint/Prettier 설정
- [x] Firebase SDK 연결 (익명 인증 사용, Google은 M1 이후)
- [x] 기본 라우팅: `/`(landing), `/lobby/[code]`, `/game/[roomId]`

**DoD**
- [ ] 배포(Vercel) 후 Firebase 연결이 정상 동작

---

## M1. 로비(E2E)
- [x] 방 생성: `rooms` + `roomCodes` (`roomApi.ts` `createRoom()`, 랜딩 페이지 연결)
- [x] 방 참가: 코드 → roomId 조회 → players 문서 생성 (`joinRoomByCode()` + 로비 참가 폼)
- [x] 참가자 리스트 실시간 표시 (`subscribeToPlayers()` onSnapshot 구독)
- [x] Ready 토글 / 팀 선택 (`updatePlayerReady()`, `updatePlayerTeam()` + ActionBar)
- [x] host만 "게임 시작" 버튼 (ActionBar `isHost` 조건 분기)

**DoD**
- [ ] 2~4명이 로비에 모이고, Ready/팀 변경이 서로 실시간 반영 (E2E 검증 필요)

---

## M2. 게임 엔진(로컬 단위 테스트)
- [x] 카드/덱 모델(104장) + 셔플 (`src/domain/cards/deck.ts`)
- [x] 보드 레이아웃 상수 JSON 확정(내용은 01-game-rules boardImages와 동일, 클라이언트에서는 JSON만 사용, 18-board-layout 참조) (`src/domain/board/board-layout.v1.json`)
- [x] 칩 점유 맵(chipsByCell) 기반 보드 상태 (`src/domain/types.ts` — `ChipsByCell` 타입 정의)
- [x] 잭/데드 카드 규칙 함수 (`src/domain/rules/jacks.ts`, `deadCard.ts`)
- [x] 시퀀스 판정 알고리즘 (`src/domain/rules/sequenceDetect.ts`, Vitest 52개 통과)

**DoD**
- [ ] domain 함수만으로 한 턴 진행이 가능(입력 state + action → 출력 state)

---

## M3. 게임 시작(딜링/초기화)
- [x] host가 dealer로 덱 생성/보관(privateDealer) (`gameApi.ts` `startGame()` → WriteBatch)
- [x] 각 플레이어 privateHands 초기 딜링 (`privateHands/{uid}` 배치 쓰기, 2~4인 6장)
- [x] public game 초기 상태 write (`rooms/{roomId}.game` + `status="playing"`)

**DoD**
- [ ] 로비에서 start 누르면 모든 클라이언트가 game 화면으로 이동 및 손패 확인 (E2E 검증 필요)

---

## M4. 턴 진행(실시간)
- [x] public room doc 구독(onSnapshot) (`roomApi.subscribeToRoom`, game 페이지 구독)
- [x] privateHands 구독(onSnapshot) (`gameApi.subscribeToHand`)
- [x] 액션 제출(트랜잭션): normal/jack (데드 카드는 교체 없음, 사용 불가만)
- [x] 충돌 처리(expectedVersion mismatch) (`gameApi.submitTurnAction` 내 검사)
- [x] 승리 판정 및 ended 전환 (`gameApi` phase `ended`, `game.winner`)

**DoD**
- [ ] 2~4명이 실제로 한 판 끝까지 플레이 가능 (E2E 검증 필요)

---

## M5. UX 폴리싱
- [x] 가능한 칸/제거 가능 칩 하이라이트 (`domain/rules/highlight.ts` + game 페이지 연동)
- [x] txPending 잠금/피드백 (game 페이지 `txPending` 상태로 턴 액션 비활성화·스피너)
- [ ] 재접속 복원 안정화
- [ ] 오류 토스트/가이드 문구(How to play)

**DoD**
- [ ] 초심자도 룰을 크게 헤매지 않고 1판 완주 가능

---

## M6. 품질/운영
- [ ] 보안 규칙 적용 및 검증
- [ ] 간단한 이벤트 로그(선택)
- [ ] 라이트 성능 최적화(보드 cell memo)
- [ ] (선택) Sentry/분석 도입

**DoD**
- [ ] 타 계정이 손패를 읽거나 게임 상태를 임의로 바꾸기 어렵다

---

## 개인전(3인 1대1대1)

> 기존 2팀(1v1/2v2) 외에 3인이 각자 1팀이 되는 개인전 모드. 요구사항 정리 및 구현 체크리스트.

### 개요
- **레드 · 블루 · 그린** 세 팀, **레드 → 블루 → 그린** 순서로 턴 진행.
- 방 생성 시 또는 로비에서 **게임 모드** 선택:
  - 기존: 2팀(1v1 / 2v2) — 레드 vs 블루
  - 신규: **개인전(3인)** — 레드 vs 블루 vs 그린
- 개인전일 때: 참여 슬롯 **3명** 고정(팀당 1명).

### 승리 조건
- **2팀 모드**: 먼저 **2시퀀스** 완성한 팀 승리(MVP 기존).
- **개인전(3인)**: 먼저 **1시퀀스** 완성한 플레이어(팀) 승리.

### 수용 기준(체크리스트)
- [ ] 방 생성/로비에서 "개인전(3인)" 모드 선택 가능
- [ ] 개인전 시 팀 레드·블루·그린만 존재, 턴 순서 레드 → 블루 → 그린
- [ ] 3명 참가·Ready 후 시작 시 1시퀀스 완성으로 해당 팀 승리 종료
- [ ] 2팀 모드(1v1/2v2)와 데이터 모델·UI에서 구분 가능

---

## 플레이 테스트 피드백(체크리스트)

> 친구들과 테스트 플레이 후 수집한 피드백. 구현 전 요구사항 정리용.

### 1. 시퀀스 완성 팝업 타이밍
- [ ] 칩을 놓아 시퀀스가 완성된 경우, 팝업을 **즉시가 아니라 1초 뒤**에 표시한다.

### 2. 상대 턴에도 손패로 위치 확인
- [x] **내 턴이 아닐 때도** 손패 카드를 클릭할 수 있다.
- [x] 클릭한 카드에 대응하는 보드 칸을 하이라이트(또는 표시)하여 위치를 확인할 수 있게 한다.
- [x] 상대 턴일 때는 **보드 칸(카드)은 클릭 불가** — 선택/하이라이트만 보여주고 액션은 불가.

### 3. 모바일 뷰에서 판 영역 확대
- [ ] 모바일 뷰에서 **상단 상태 표시줄** 높이 또는 padding(y) 줄이기.
- [ ] **손패 섹션** 높이 또는 padding(py) 줄이기.
- [ ] **액션 상태 표시줄** 높이 또는 py 줄이기.
- [ ] 위 축소로 **보드(판) 영역을 키운다**.

### 4. 턴 제한 30초 타이머
- [ ] **상단 상태 표시줄에 30초 타이머** 표시.
- [ ] 각 플레이어 턴마다 **30초 제한** 적용.
- [ ] 시간 **임박 시** 빨간색 + 애니메이션으로 강조.
- [ ] **시간 종료 시** 자동 처리:
  - 잭(2-eye/1-eye) **제외**한 카드 중 하나를 자동 선택·사용.
  - 해당 카드에 대응하는 **가능한 칸 중 하나**에 칩 배치(빈 칸이 있으면 그중 하나; 두 칸 모두 비어 있으면 하나 선택; 사용 불가능한 카드(데드카드)면 다른 카드를 사용; 모든 카드가 데드카드 or 잭이면 카드를 사용하지 않고 턴을 넘긴다).
  - 배치 후 턴 넘김(드로우 등 기존 턴 종료 로직 수행).

**DoD(4번)**  
- [ ] 30초 내 액션 없으면 자동으로 카드 1장 사용 + 칩 배치 + 턴 넘김이 동작한다.

### 5. 로비 관전하기 버튼
- [x] 로비 페이지에 **관전하기** 버튼을 추가한다.
- [x] 관전자는 **팀 배정에서 제외**되는 것으로 인지해야 한다(UI/문구로 명시).
- [x] 관전자가 다시 게임에 참여할 때: **4명이 이미 차 있으면 참여 불가**.
- [x] 참여 가능할 때는 **방 입장 시와 같은 로직**으로 팀이 배정되어야 한다.

### 6. 방 생성자 자동 준비
- [x] **방을 생성한 사람(host)**은 생성 직후 자동으로 **준비 상태**가 되도록 한다.

### 7. 게임 순서 = 준비 시점 기준(팀 내 순서 조정)
- [x] 게임 순서는 **플레이어 목록**을 기반으로 한다.
- [x] 현재는 방 입장 순서로 정해져 있는데, **가장 마지막에 준비 상태가 된 시점**을 기준으로 순서가 정해지도록 변경한다.
- [x] **레드 → 블루 → 레드 → 블루** 팀 순서는 유지된다.
- [x] 의도: 팀 내에서 순서가 마음에 안 들면 **준비 상태를 토글**하면서 순서를 변경할 수 있어야 한다.

### 8. 게임 종료 후 로비로 이동(재게임 UX)
- [ ] 게임 종료 시, **나가기** 버튼으로 루트가 아니라 **로비로 이동**하도록 UX를 수정한다.
- [ ] 로비에서 **다시 게임을 재개**할 수 있도록 유도한다.
- [ ] 이때 **방장을 포함한 모든 플레이어**는 **대기 상태(준비 해제)**가 되어야 한다.

---

## 진행도 점검 템플릿(주간/스프린트)
아래를 복사해 이슈/노션/깃허브 프로젝트에 사용.

- [ ] 이번 주 목표(Mx): ____
- [ ] 완료한 PR:
  - [ ] PR#__
- [ ] 남은 리스크:
  - [ ] ____
- [ ] 비용/트래픽 점검:
  - [ ] 구독 문서 수: public __ / private __ / events __
  - [ ] 턴당 write 횟수: __
- [ ] 다음 작업:
  - [ ] ____
